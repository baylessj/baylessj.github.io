<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jonathan Bayless - Gradle Configuration for Firebase Usage in Flutter</title>
  <meta name="author" content="Jonathan Bayless" />
  <meta name="description" content="The blog of Jonathan Bayless" />
  <link rel="canonical" href="http://localhost:4000/2019/08/07/flutter-firebase-gradle.html" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/atom+xml" title="Jonathan Bayless" href="http://localhost:4000/atom.xml" />

  <link rel="stylesheet" href="/assets/css/all.css">
  <link rel="stylesheet" href="/css/styles.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1> </h1>
  <a href="/">
    <img src="http://localhost:4000/assets/me_square.jpg" id="logo" alt="Blog logo"/>
  </a>
  <h2>I'm <br>
    <a href="/">Jonathan Bayless</a>.</h2>
  <div id="bio">
    <p>Software Developer, <br>
      Robotics Enthusiast.</p>
  </div>
  <div id="resume">
    <a href="./assets/resume.pdf"><i class="fa fa-file-text"></i> Resume</a>
  </div>
  <div id="social">
    <div id="stalker">
  
  <a title="baylessj on Github" href="https://github.com/baylessj">
    <i class="fa fa-github-square"></i>
  </a>
  

  

  

  

  

  

  

  

  
  <a title="Jonathan Bayless on LinkedIn" href="https://www.linkedin.com/in/jonathanbayless">
    <i class="fa fa-linkedin-square"></i>
  </a>
  

  

  

  
  <a title="Atom feed" id="atom" href="/atom.xml">
    <i class="fa fa-rss-square"></i>
  </a>
  
</div>

  </div>
</nav>

    </div>

    <div class="eleven columns content">
      <p class="meta">
  August 07, 2019 
  <a href="/">
    <i class="home fa fa-home"></i>
  </a>
</p>

<h1 class="title">Gradle Configuration for Firebase Usage in Flutter</h1>

<div id="post">
  <p>I recently got started developing a cross-platform app in <a href="https://flutter.dev/">Flutter</a>, a framework developed by Google that uses the <a href="https://dart.dev/">Dart</a> programming language. One major benefit of the fact that Flutter is created by Google is the <em>mostly</em> easy integration with Google’s other services. I have come across one minor exception to this rule in my attempt to integrate <a href="https://firebase.google.com/">Firebase</a> with my Flutter project.</p>

<h1 id="original-gradle-modifications">Original Gradle Modifications</h1>

<p>I followed along with Google’s guide on modifying my app’s <a href="https://gradle.org/">Gradle</a> configuration files to integrate Firebase services into the app. It may seem obvious to people who have used Gradle before, but as a complete newbie to the tool I quickly ran into a few issues that were solved by paying better attention to which modifications were supposed to the be made to the <code class="highlighter-rouge">android</code> directory’s Gradle config and which modifications were to be made to the <code class="highlighter-rouge">android/app</code> directory’s Gradle config.</p>

<p>My Gradle config files after implementing the Google guide’s changes were as follows:</p>

<p><code class="highlighter-rouge">./android/</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>buildscript {
    repositories {
        google()
        jcenter()
    }

    dependencies {
        classpath 'com.android.tools.build:gradle:3.2.1'
        classpath 'com.google.gms:google-services:4.3.0'
    }
}

allprojects {
    repositories {
        google()
        jcenter()
    }
}

rootProject.buildDir = '../build'
subprojects {
    project.buildDir = "${rootProject.buildDir}/${project.name}"
}
subprojects {
    project.evaluationDependsOn(':app')
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
</code></pre></div></div>

<p><code class="highlighter-rouge">./android/app/</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader -&gt;
        localProperties.load(reader)
    }
}

def flutterRoot = localProperties.getProperty('flutter.sdk')
if (flutterRoot == null) {
    throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode')
if (flutterVersionCode == null) {
    flutterVersionCode = '1'
}

def flutterVersionName = localProperties.getProperty('flutter.versionName')
if (flutterVersionName == null) {
    flutterVersionName = '1.0'
}

apply plugin: 'com.android.application'
apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"

android {
    compileSdkVersion 28

    lintOptions {
        disable 'InvalidPackage'
    }

    defaultConfig {
        applicationId "com.jonathanbayless.autodo"
        minSdkVersion 16
        targetSdkVersion 28
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            // TODO: Add your own signing config for the release build.
            // Signing with the debug keys for now, so `flutter run --release` works.
            signingConfig signingConfigs.debug
        }
    }
}

flutter {
    source '../..'
}

dependencies {
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}

apply plugin: 'com.google.gms.google-services'  // Google Play services Gradle plugin
</code></pre></div></div>

<h1 id="too-many-methods-for-one-dex-file">Too many methods for one Dex file</h1>

<p>After I was done making a number of silly mistakes due to not reading through the Google with enough care I was met with a build error that was not addressed in the Google guide. The addition of the <code class="highlighter-rouge">google-services</code> package inflated the size of the built project to the point that it exceeded the number of methods allowed in a single <code class="highlighter-rouge">.dex</code> file.</p>

<h1 id="todo-add-an-explanation-on-what-a-dex-file-is">todo: add an explanation on what a dex file is</h1>

<p>The solution I found to this error consisted of two changes: enabling a build flag regarding the <code class="highlighter-rouge">.dex</code> generation and changing the target Android SDK.</p>

<p>I added the following lines:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>multiDexEnabled true
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shrinkResources true
minifyEnabled true
</code></pre></div></div>

<p>Working <code class="highlighter-rouge">./android/app/</code> config file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader -&gt;
        localProperties.load(reader)
    }
}

def flutterRoot = localProperties.getProperty('flutter.sdk')
if (flutterRoot == null) {
    throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode')
if (flutterVersionCode == null) {
    flutterVersionCode = '1'
}

def flutterVersionName = localProperties.getProperty('flutter.versionName')
if (flutterVersionName == null) {
    flutterVersionName = '1.0'
}

apply plugin: 'com.android.application'
apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"

android {
    compileSdkVersion 28

    lintOptions {
        disable 'InvalidPackage'
    }

    defaultConfig {
        applicationId "com.jonathanbayless.autodo"
        minSdkVersion 16
        targetSdkVersion 28
        multiDexEnabled true
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            // TODO: Add your own signing config for the release build.
            // Signing with the debug keys for now, so `flutter run --release` works.
            signingConfig signingConfigs.debug
            shrinkResources true
            minifyEnabled true
        }
    }
}

flutter {
    source '../..'
}

dependencies {
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}

apply plugin: 'com.google.gms.google-services'  // Google Play services Gradle plugin
</code></pre></div></div>

</div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li>
      <span>16 Jun 2019 &raquo;</span> <a href="/blog/2019/06/16/helloworld.html">Hello World</a>
    </li>
    
  </ul>
</div>


      <div class="footer">
        <div class="disclaimer">
  
  <p>
    The postings on this site are my own and don't necessarily represent my 
    employer’s positions, strategies or opinions.
  </p>
  

  <p>
    © Jonathan Bayless, 2019 &mdash; built with <a href="http://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/swanson/lagom">Lagom theme</a>
  </p>
</div>
      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
